version: '3'
services:
  web:
    container_name: web1
    restart: always
    build: ./web
    expose:
      - "9000"
    volumes:
      - static:/usr/src/app/static
  nginx:
    container_name: nginx1
    restart: always
    build: ./nginx
    ports:
      - "80:80"
      - "443:443"
    links:
      - web
      - letsencrypt
    volumes:
      - static:/static
      - /etc/letsencrypt/
      - /var/lib/letsencrypt/
  letsencrypt:
    container_name: letsencrypt1
    # restart: always
    image: quay.io/letsencrypt/letsencrypt:latest
    command: bash -c "sleep 6 && certbot certonly --standalone -d ataraxia.io --text --agree-tos --email lelandlater@gmail.com --server https://acme-v01.api.letsencrypt.org/directory --rsa-key-size 4096 --verbose --renew-by-default --standalone-supported-challenges http-01"
    entrypoint: ""
    ports:
      - "80"
      - "443"
    volumes:
      - le1:/etc/letsencrypt
      - le2:/var/lib/letsencrypt
volumes:
  static:
  le1:
  le2:
